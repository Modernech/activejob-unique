<style type="text/css">
  a.no-decoration:focus, a.no-decoration:hover {
    text-decoration: none;
  }
  header.row .pagination {
    margin: 25px 0 0 0 !important;
  }
  form .btn {
    margin-right: 0;
  }
  .label-none {
    background: #eee;
    color: #999;
  }
</style>
<%
  def stats_label(value, style)
    if "#{value}" == "0"
      return "<span class='label label-none'>#{value}</span>"
    else
      return "<span class='label label-#{style}'>#{value}</span>"
    end
  end
%>
<header class='row'>
  <div class='col-sm-5 col-xs-12'>
    <h3>Jobs stats for
      <span class="title"><%= @queue_name %></span>
      during
      <span class="title"><%= @stage %></span>
    </h3>
  </div>
  <div class='col-sm-5 col-xs-8'>
    <div style="margin-top: 30px; font-size: 130%;" class="pull-left">
      <a class="no-decoration" href="<%= root_path %>job_stats/<%= @switch_stage %>/<%= @queue_name %>">
        <%= stats_label("view #{@switch_stage} jobs", 'success') %>
      </a>
    </div>

    <% if @job_stats.size > 0 && @total_size > @count %>
      <%= erb :_paging, :locals => { :url => "#{root_path}job_stats/#{@stage}/#{@queue_name}" } %>
    <% end %>
  </div>
  <div class='col-sm-2 col-xs-4 text-right'>
    <form method="POST" style="margin-top: 25px;" action="<%= "#{root_path}job_stats/#{@stage}/#{@queue_name}/delete" %>">
      <%= csrf_tag %>
      <input class='btn btn-danger' type="submit" name="delete" value="Delete All" data-confirm="Are you sure you want to delete all (<%= @stage %>) stats in: [<%= @queue_name %>]?"/>
    </form>
  </div>
</header>
<% if @job_stats.size > 0 %>
  <table class="table table-hover table-bordered table-striped table-white">
    <thead>
      <th>Job</th>
      <th><%= stats_label('Skipped', 'warning') %></th>
      <th><%= stats_label('Processing', 'info') %></th>
      <th><%= stats_label('Processed', 'success') %></th>
      <th><%= stats_label('Failed', 'danger') %></th>
      <th><%= stats_label('Attempted', 'primary') %></th>
    </thead>
    <tbody>
      <% @job_stats.each do |job| %>
        <tr>
          <td><%= job[:klass] %></td>
          <td>
            <%= stats_label(job[:skipped][:today], 'warning') %> /
            <%= stats_label(job[:skipped][:all], 'default') %>
          </td>
          <td>
            <%= stats_label((job[:attempted][:today]-job[:processed][:today]-job[:skipped][:today]-job[:failed][:today]), 'info') %> /
            <%= stats_label((job[:attempted][:all]-job[:processed][:all]-job[:skipped][:all]-job[:failed][:all]), 'default') %>
          </td>
          <td>
            <%= stats_label(job[:processed][:today], 'success') %> /
            <%= stats_label(job[:processed][:all], 'default') %>
          </td>
          <td>
            <%= stats_label(job[:failed][:today], 'danger') %> /
            <%= stats_label(job[:failed][:all], 'default') %>
          </td>
          <td>
            <%= stats_label(job[:attempted][:today], 'primary') %> /
            <%= stats_label(job[:attempted][:all], 'default') %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <div class='alert alert-success'>No job stats found</div>
<% end %>
